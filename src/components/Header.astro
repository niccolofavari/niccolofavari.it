---
// src/components/Header.astro
import { SITE_TITLE_EN, SITE_TITLE_IT, NAV_LINKS_CONFIG } from '../site-config';

const { lang, currentPath } = Astro.props; 

const siteTitle = lang === 'it' ? SITE_TITLE_IT : SITE_TITLE_EN;
const navLinks = lang === 'it' ? NAV_LINKS_CONFIG.it : NAV_LINKS_CONFIG.en;

const otherLang = lang === 'en' ? 'it' : 'en';
let otherLangPath = `/${otherLang}/`; 

if (currentPath) {
  const pathParts = currentPath.split('/').filter(p => p); 
  if (pathParts.length > 1) { 
    pathParts[0] = otherLang; 
    otherLangPath = `/${pathParts.join('/')}${currentPath.endsWith('/') && pathParts.length === 2 ? '/' : ''}`;
    
    const currentCategorySlug = pathParts[1];
    const currentLangNavs = NAV_LINKS_CONFIG[lang];
    const otherLangNavs = NAV_LINKS_CONFIG[otherLang];

    if (currentLangNavs && otherLangNavs) {
        const currentNavLinkIndex = currentLangNavs.findIndex(link => link.categorySlug === currentCategorySlug);
        if (currentNavLinkIndex !== -1 && otherLangNavs[currentNavLinkIndex] && otherLangNavs[currentNavLinkIndex].categorySlug !== 'home') {
            pathParts[1] = otherLangNavs[currentNavLinkIndex].categorySlug;
            otherLangPath = `/${pathParts.join('/')}${currentPath.endsWith('/') && pathParts.length === 2 ? '/' : ''}`;
        }
    }
  }
}
---
<header class="site-header">
  <nav class="site-header__nav container">
    <div class="site-header__brand">
      <a href={`/${lang}/`}>{siteTitle}</a>
    </div>
    <div class="site-header__actions">
      <a 
        href={otherLangPath} 
        aria-label={lang === 'en' ? 'Switch to Italian' : 'Passa all\'Inglese'}
        class="site-header__lang-switcher"
      >
        {otherLang.toUpperCase()}
      </a>
      <div class="site-header__menu">
        {navLinks.filter(link => link.categorySlug !== "home").map(link => {
          const isActive = currentPath === link.href || (currentPath && link.href !== `/${lang}/` && currentPath.startsWith(link.href));
          return (
            <a 
              href={link.href} 
              class:list={["site-header__menu-link", { "is-active": isActive }]}
              aria-current={isActive ? "page" : false}
            >
              {link.name}
            </a>
          );
        })}
      </div>
      {/* TODO: Mobile menu (hamburger) can be added here */}
    </div>
  </nav>
</header>

<style lang="scss">
  @use 'sass:color';
  @use '../styles/utils/variables' as *;

  .site-header {
    background-color: $color-bg-light;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    position: sticky;
    top: 0;
    z-index: $z-index-sticky;
    padding: $space-s 0;
  }

  .site-header__nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .site-header__brand a {
    font-size: $font-size-step-1;
    font-weight: 700;
    color: $color-text-dark;
    text-decoration: none;
    transition: color $transition-base;

    &:hover, &:focus {
      color: $color-secondary;
    }
  }

  .site-header__actions {
    display: flex;
    align-items: center;
  }

  .site-header__lang-switcher {
    padding: 0.5em 1em;
    border: 1px solid $color-border;
    border-radius: $border-radius-md;
    text-decoration: none;
    font-size: $font-size-step-minus-1;
    font-weight: 600;
    color: $color-text-dark;
    margin-right: $space-m;
    transition: $transition-base;

    &:hover, &:focus {
      background-color: $color-secondary;
      color: $color-text-light;
      border-color: $color-secondary;
    }
  }

  .site-header__menu-link {
    padding: 0.5em 1em;
    text-decoration: none;
    color: $color-text-dark;
    border-radius: $border-radius-md;
    transition: $transition-base;
    font-size: $font-size-step-0;

    &:hover, &:focus {
      color: $color-secondary;
    }

    &.is-active {
      font-weight: 700;
      color: $color-primary;
    }
  }

  // Dark Mode Styles
  :global(.dark) {
    .site-header {
      background-color: $color-bg-dark;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .site-header__brand a {
      color: $color-text-light;
      &:hover, &:focus {
        color: $color-accent;
      }
    }

    .site-header__lang-switcher {
      color: $color-text-light;
      border-color: $color-border-dark;
      &:hover, &:focus {
        background-color: $color-accent;
        color: $color-text-dark;
        border-color: $color-accent;
      }
    }

    .site-header__menu-link {
      color: $color-text-light;
      &:hover, &:focus {
        color: $color-accent;
      }
      &.is-active {
        color: $color-accent;
      }
    }
  }
</style>
